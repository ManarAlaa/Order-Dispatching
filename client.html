<!DOCTYPE html>
<html>
<head>
  <title>Pusher Test</title>
  <script src="https://js.pusher.com/7.2/pusher.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>

const baseURL = 'https://jimmy.nader-mo.tech';

    Pusher.logToConsole = true;

let pusher = new Pusher('bec24d45349a2eb1b439', {
  cluster: 'eu'
});

    let channel = pusher.subscribe('orders');
    channel.bind('newOrder', function(orderData) {
      console.log("in client in pusher");

      // Send a request to orderController.saveOrder()
      alert(JSON.stringify(orderData));

      axios.post(`${baseURL}/orders/save`, orderData)
        .then(function () {
          // Send a request to orderController.getall()
          axios.get(`${baseURL}/orders`)
            .then(function (response) {
              console.log('Orders retrieved:', response.data);
              // Send a request to dispatchController.assignOrder()
              axios.get(`${baseURL}/dispatch/${orderData._id}`)
                .catch(function (error) {
                  console.error("Error:", error);
                });
            })
            .catch(function (error) {
              console.error("Error:", error);
            });
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    });
  </script>
</head>
<body>
</body>
</html>
